/* browser.js v1.1 (refactor legible)
 * Original v1.0 | @ajlkn | MIT licensed
 */

var browser = (function () {
	'use strict';

	const Browser = {
		name: null,
		version: null,
		os: null,
		osVersion: null,
		touch: null,
		mobile: null,
		_canUse: null, // elemento usado internamente para probar propiedades CSS

		/**
		 * Comprueba si el navegador puede usar una propiedad CSS.
		 * Ej: browser.canUse('transition')
		 */
		canUse(prop) {
			if (!this._canUse) {
				this._canUse = document.createElement('div');
			}

			const style = this._canUse.style;
			const prefixed = prop.charAt(0).toUpperCase() + prop.slice(1);

			return (
				prop in style ||
				('Moz' + prefixed) in style ||
				('Webkit' + prefixed) in style ||
				('O' + prefixed) in style ||
				('ms' + prefixed) in style
			);
		},

		/**
		 * Detecta navegador, SO, soporte táctil y si es móvil.
		 */
		init() {
			const ua = navigator.userAgent;

			// -----------------------
			// 1) Navegador + versión
			// -----------------------
			let name = 'other';
			let version = 0;

			const browserMatchers = [
				['firefox', /Firefox\/([0-9\.]+)/],
				['bb', /BlackBerry.+Version\/([0-9\.]+)/],
				['bb', /BB[0-9]+.+Version\/([0-9\.]+)/],
				['opera', /OPR\/([0-9\.]+)/],
				['opera', /Opera\/([0-9\.]+)/],
				['edge', /Edge\/([0-9\.]+)/],
				['safari', /Version\/([0-9\.]+).+Safari/],
				['chrome', /Chrome\/([0-9\.]+)/],
				['ie', /MSIE ([0-9]+)/],
				['ie', /Trident\/.+rv:([0-9]+)/]
			];

			for (let i = 0; i < browserMatchers.length; i++) {
				const [id, regex] = browserMatchers[i];
				if (ua.match(regex)) {
					name = id;
					version = parseFloat(RegExp.$1);
					break;
				}
			}

			this.name = name;
			this.version = version;

			// -----------------------
			// 2) Sistema operativo
			// -----------------------
			let osName = 'other';
			let osVersion = 0;

			const osMatchers = [
				// iOS: "13_3 like Mac OS X"
				[
					'ios',
					/([0-9_]+) like Mac OS X/,
					function (v) {
						return v.replace('_', '.').replace('_', '');
					}
				],
				// iOS genérico sin versión
				['ios', /CPU like Mac OS X/, function () { return 0; }],
				['wp', /Windows Phone ([0-9\.]+)/, null],
				['android', /Android ([0-9\.]+)/, null],
				[
					'mac',
					/Macintosh.+Mac OS X ([0-9_]+)/,
					function (v) {
						return v.replace('_', '.').replace('_', '');
					}
				],
				['windows', /Windows NT ([0-9\.]+)/, null],
				['bb', /BlackBerry.+Version\/([0-9\.]+)/, null],
				['bb', /BB[0-9]+.+Version\/([0-9\.]+)/, null],
				['linux', /Linux/, null],
				['bsd', /BSD/, null],
				['unix', /X11/, null]
			];

			for (let i = 0; i < osMatchers.length; i++) {
				const [id, regex, transform] = osMatchers[i];
				if (ua.match(regex)) {
					osName = id;
					osVersion = parseFloat(transform ? transform(RegExp.$1) : RegExp.$1);
					break;
				}
			}

			this.os = osName;
			this.osVersion = osVersion;

			// -----------------------
			// 3) Soporte táctil
			// -----------------------
			if (this.os === 'wp') {
				// Windows Phone
				this.touch = navigator.msMaxTouchPoints > 0;
			} else {
				this.touch = 'ontouchstart' in window;
			}

			// -----------------------
			// 4) ¿Es móvil?
			// -----------------------
			this.mobile =
				this.os === 'wp' ||
				this.os === 'android' ||
				this.os === 'ios' ||
				this.os === 'bb';
		}
	};

	// Inicializar inmediatamente (igual que en la versión original).
	Browser.init();

	return Browser;
})();

/* UMD wrapper: AMD / CommonJS / global */
(function (root, factory) {
	if (typeof define === 'function' && define.amd) {
		// AMD
		define([], factory);
	} else if (typeof exports === 'object') {
		// CommonJS
		module.exports = factory();
	} else {
		// Global
		root.browser = factory();
	}
})(this, function () {
	return browser;
});
